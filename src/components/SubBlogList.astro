---
import { ScrollArea } from '@/components/ui/scroll-area'
import { Icon } from 'astro-icon/components'
import { Image } from 'astro:assets'
import { getCollection } from 'astro:content'

export interface Props {
  parentId: string
  title: string
}

const { parentId, title } = Astro.props

// 해당 부모 ID를 가진 서브 블로그 포스트 가져오기
const subPosts = (await getCollection('blog', ({ data }) => !data.draft))
  .filter(
    (post) =>
      post.id.startsWith(`${parentId}/`) && post.id !== `${parentId}/index`,
  )
  .sort((a, b) => a.data.date.valueOf() - b.data.date.valueOf())
---

<details open class="group mt-5 rounded-xl border p-4">
  <summary
    class="mb-3 flex cursor-pointer items-center justify-between text-xl font-medium"
  >
    {title}
    <Icon
      name="lucide:chevron-down"
      class="size-5 transition-transform group-open:rotate-180"
    />
  </summary>

  <ScrollArea
    client:load
    className="flex max-h-96 flex-col overflow-y-auto"
    type="always"
  >
    <ul class="mt-[-0.02rem] flex flex-col gap-4 p-1">
      {
        subPosts.map((post) => (
          <a
            href={`/blog/${post.id}`}
            class="hover:bg-muted/50 mr-5 block rounded-lg border no-underline transition-colors"
          >
            <div class="mt-[-1rem] mb-[-1rem] flex flex-row gap-4">
              {post.data.image ? (
                <div class="max-w-[200px] pl-5 sm:shrink-0">
                  <Image
                    src={post.data.image}
                    alt={post.data.title}
                    width={400}
                    height={200}
                    class="rounded-lg object-cover"
                  />
                </div>
              ) : (
                <div class="h-24 w-24 shrink-0">
                  <img
                    src={`/og/${post.id}.png`}
                    alt={post.data.title}
                    width={400}
                    height={200}
                    class="h-full w-full rounded-lg object-cover"
                  />
                </div>
              )}

              <div class="grow pt-5 pl-3">
                <h3 class="mb-1 text-lg font-medium">
                  {post.data.title.includes(': ')
                    ? post.data.title.split(': ')[1]
                    : post.data.title}
                </h3>
                <p class="text-muted-foreground mt-[-0.1rem] mr-5 text-sm">
                  {post.data.description}
                </p>
              </div>
            </div>
          </a>
        ))
      }
    </ul>
  </ScrollArea>
</details>
