---
title: '릴리움 개발일지: 2. 타일맵 시스템'
description: '유니티에서 효율적인 2D 타일맵을 설계하고 구현하는 방법을 소개합니다.'
date: 2023-09-17
tags: ['게임개발', '유니티', '타일맵', '레벨디자인']
image: '../assets/background.webp'
authors: ['hy']
hidden: true
tableOfContentsTitle: '개발일지 목차'
tableOfContents:
  - {
      depth: 2,
      slug: '/blog/lilium-devlog#intro',
      text: '소개',
      subheadings: [],
    }
  - {
      depth: 2,
      slug: '/blog/lilium-devlog#chapters',
      text: '챕터별 개발일지',
      subheadings:
        [
          {
            depth: 3,
            slug: '/blog/lilium-devlog/day1',
            text: '1. 캐릭터 디자인',
            subheadings: [],
          },
          {
            depth: 3,
            slug: '/blog/lilium-devlog/day2',
            text: '2. 타일맵 시스템',
            subheadings: [],
          },
          {
            depth: 3,
            slug: '/blog/lilium-devlog/day3',
            text: '3. 전투 메커니즘',
            subheadings: [],
          },
        ],
    }
  - {
      depth: 2,
      slug: '/blog/lilium-devlog#roadmap',
      text: '향후 계획',
      subheadings: [],
    }
activeSlug: '/blog/lilium-devlog/day2'
parentTitle: '릴리움 개발일지: 2D 픽셀 RPG 만들기'
parentSlug: '/blog/lilium-devlog'
---

# 타일맵 시스템

RPG 게임에서 세계를 구성하는 타일맵은 게임의 시각적 아이덴티티를 결정하는 중요한 요소입니다. 이 챕터에서는 릴리움을 위한 타일맵 시스템을 구축하는 과정을 설명하겠습니다.

## 타일셋 디자인

타일맵을 만들기 전, 다양한 환경을 표현할 수 있는 타일셋을 제작해야 합니다. 릴리움에서는 다음과 같은 6가지 환경을 기본으로 설정했습니다:

1. 초원(Grassland)
2. 숲(Forest)
3. 마을(Village)
4. 던전(Dungeon)
5. 산악(Mountain)
6. 해안(Coast)

각 환경마다 다음 요소들이 포함된 16x16 픽셀 타일을 디자인했습니다:

- 기본 바닥 타일
- 벽과 장애물
- 장식용 오브젝트(꽃, 바위, 나무 등)
- 전환 타일(환경 간 자연스러운 전환을 위한)

## 유니티 타일맵 설정

유니티의 2D 타일맵 시스템을 사용하여 다음과 같이 타일맵을 구성했습니다:

1. 타일 팔레트 생성:

```csharp
// 에디터 확장 예제
#if UNITY_EDITOR
using UnityEditor;
using UnityEngine;
using UnityEngine.Tilemaps;

public class TilePaletteCreator
{
    [MenuItem("Tools/Create Tile Palettes")]
    public static void CreateTilePalettes()
    {
        // 각 환경별 타일 팔레트 자동 생성 코드
        string[] environments = { "Grassland", "Forest", "Village", "Dungeon", "Mountain", "Coast" };

        foreach (var env in environments)
        {
            // 팔레트 생성 로직
            // ...
        }
    }
}
#endif
```

2. 타일맵 레이어 구성:

- 바닥 레이어(Ground)
- 장애물 레이어(Obstacles)
- 장식 레이어(Decorations)
- 충돌 레이어(Collision)

## 타일 규칙 및 자동화

타일맵 작업을 효율화하기 위해 유니티의 규칙 타일(Rule Tile)을 활용했습니다:

```csharp
public class AutoTile : RuleTile<AutoTile.Neighbor> {
    public class Neighbor : RuleTile.TilingRule.Neighbor {
        public const int Null = 3;
        public const int NotNull = 4;
    }

    public override bool RuleMatch(int neighbor, TileBase tile) {
        switch (neighbor) {
            case Neighbor.Null: return tile == null;
            case Neighbor.NotNull: return tile != null;
        }
        return base.RuleMatch(neighbor, tile);
    }
}
```

이를 통해 벽, 코너, 모서리 등이 자동으로 적절한 타일로 배치되도록 했습니다.

## 맵 전환 및 로딩

큰 세계를 효율적으로 관리하기 위해 맵을 여러 구역으로 나누고, 필요할 때만 로드하는 시스템을 구현했습니다:

```csharp
public class MapManager : MonoBehaviour
{
    [SerializeField] private List<GameObject> mapSections;
    [SerializeField] private Transform player;
    [SerializeField] private float loadDistance = 30f;

    private Dictionary<GameObject, bool> mapSectionStates = new Dictionary<GameObject, bool>();

    void Update()
    {
        foreach (var section in mapSections)
        {
            float distance = Vector2.Distance(player.position, section.transform.position);
            bool shouldBeActive = distance <= loadDistance;

            if (mapSectionStates.TryGetValue(section, out bool isActive))
            {
                if (isActive != shouldBeActive)
                {
                    section.SetActive(shouldBeActive);
                    mapSectionStates[section] = shouldBeActive;
                }
            }
            else
            {
                section.SetActive(shouldBeActive);
                mapSectionStates.Add(section, shouldBeActive);
            }
        }
    }
}
```

## 성능 최적화

대규모 타일맵에서 발생할 수 있는 성능 이슈를 해결하기 위해 다음과 같은 최적화 기법을 적용했습니다:

1. 타일맵 청크화: 큰 맵을 작은 청크로 분할
2. 컬링 마스크: 카메라 밖의 타일맵 렌더링 비활성화
3. 타일 아틀라스 사용: 드로우 콜 최소화

## 다음 단계

기본적인 타일맵 시스템을 구축했지만, 아직 개선할 점이 많습니다:

- 랜덤 던전 생성 알고리즘 구현
- 날씨 및 시간 시스템 통합
- 시각적 효과(물 애니메이션, 빛 효과 등) 추가
